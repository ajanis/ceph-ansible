
provisioning_ssh_key: "ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAyVfLHB6up7yWh5bkkLBFFgPbG1E7PjKEjzMAz6eVyjPyp1K5bty4FIWPL8gc\
Ih0Yjf6Z0VBB+4OPvwAf6nKtpmZmcbDETRCw6kAWDRz7C6DCJFDHNmoPfMutC5H3R0ZAlWP7zYs5cVF/DN/il2FYn7S7A8/7aewvLVF6WxiHPXYCJ5MuPKs\
hgsg92PqHfBxTCsmzekyuZ3RncqXDSaY621d/0yMRt1gQlHQPFd/UuosPg0X/JiwMGEfcU4os0ix5Iu4eucUkeMxYgHcZhm19kfl0xjTwMLDPovt42j9Wp1\
p8TeleVaxrXbZaRPQ+MRGw2bLDWyKjx0GRHIDGv38Uyw=="


foreman_install_version: 1.24
foreman_plugins_version: 1.24

foreman_hostname: foreman
foreman_interface: 0.0.0.0
foreman_port: 3000
foreman_proxy_tftp: True
foreman_proxy_dhcp: False
foreman_proxy_dns: False
foreman_proxy_bmc: True
foreman_proxy_templates: False
foreman_db_name: foreman
foreman_db_username: foreman
foreman_db_password: "{{ vault_foreman_db_password }}"
foreman_admin_user: admin
foreman_admin_group: administrators
foreman_admin_password: "{{ vault_foreman_admin_password }}"
foreman_env: production


foreman_settings:
  - name: "host_owner"
    value: "{{ foreman_admin_id }}"
  - name: "ansible_ssh_private_key_file"
    value: "{{ provisioning_ssh_key }}"
  - name: "entries_per_page"
    value: "20"
  - name: "use_shortname_for_vms"
    value: "True"
  - name: "idle_timeout"
    value: "480"


foreman_global_parameters:
  - name: remote_execution_ssh_keys
    parameter_type: array
    value:
      - "{{ provisioning_ssh_key }}"
  - name: ansible_host_config_key
    value: "{{ awx_host_config_key }}"
  - name: ansible_tower_fqdn
    value: "{{ awx_web_url }}"
  - name: ansible_enabled
    parameter_type: boolean
    value: "True"
  - name: ansible_tower_provisioning
    parameter_type: boolean
    value: "True"
  - name: kernel_params
    parameter_type: string
    value: "console=ttyS1,115200n8 console=tty1 net.ifnames=0 biosdevname=0 nosplash"
  - name: bmc_user
    parameter_type: string
    value: ADMIN
  - name: bmc_password
    parameter_type: string
    value: "{{ vault_foreman_bmc_password }}"


foreman_ldap_sources:
  - name: "ldap.home.prettybaked.com"
    host: "10.0.10.15"
    onthefly_register: True
    account: "cn=Manager,dc=ldap,dc=home,dc=prettybaked,dc=com"
    account_password: "{{ openldap_server_rootpw }}"
    base_dn: "dc=ldap,dc=home,dc=prettybaked,dc=com"
    groups_base: "ou=groups,dc=ldap,dc=home,dc=prettybaked,dc=com"
    ldap_filter: "(&(objectClass=posixAccount)(gidNumber=1042))"


#foreman_usergroups:
#  - name: "{{ foreman_admin_group }}"
#    admin: yes


foreman_external_usergroups:
  - name: admin
    auth_source_ldap: "ldap.home.prettybaked.com"
    usergroup: "{{ foreman_admin_group }}"


foreman_proxy_dhcp_subnets:
# VLAN 5 - 10.0.5.0/24
  - name: "10.0.5.0/24"
    network: "10.0.5.0"
    mask: "255.255.255.0"
    gateway: "10.0.5.1"
    boot_mode: "DHCP"
    from_ip: "10.0.5.210"
    to_ip: "10.0.5.250"
    mtu: 9000
    tftp_proxy: "smart-proxy"
    remote_execution_proxies: "smart-proxy"
    discovery_proxy: "smart-proxy"
    httpboot_proxy: "smart-proxy"
    domains:
    - "{{ www_domain }}"
    dns_primary: 10.0.5.1
# VLAN 10 - 10.0.10.0/24
  - name: "10.0.10.0/24"
    network: "10.0.10.0"
    mask: "255.255.255.0"
    gateway: "10.0.10.1"
    boot_mode: "DHCP"
    from_ip: "10.0.10.210"
    to_ip: "10.0.10.250"
    mtu: 9000
    tftp_proxy: "smart-proxy"
    remote_execution_proxies: "smart-proxy"
    discovery_proxy: "smart-proxy"
    httpboot_proxy: "smart-proxy"
    domains:
    - "{{ www_domain }}"
    dns_primary: 10.0.10.1
# VLAN 11 - 10.0.11.0/24
  - name: "10.0.11.0/24"
    network: "10.0.11.0"
    mask: "255.255.255.0"
    gateway: "10.0.11.1"
    boot_mode: "DHCP"
    from_ip: "10.0.11.210"
    to_ip: "10.0.11.250"
    tftp_proxy: "smart-proxy"
    remote_execution_proxies: "smart-proxy"
    discovery_proxy: "smart-proxy"
    httpboot_proxy: "smart-proxy"
    mtu: 9000
    domains:
    - "{{ www_domain }}"
    dns_primary: 10.0.11.1
# VLAN 12 - 10.0.12.0/24
  - name: "10.0.12.0/24"
    network: "10.0.12.0"
    mask: "255.255.255.0"
    gateway: "10.0.12.1"
    boot_mode: "DHCP"
    from_ip: "10.0.12.210"
    to_ip: "10.0.12.250"
    tftp_proxy: "smart-proxy"
    remote_execution_proxies: "smart-proxy"
    discovery_proxy: "smart-proxy"
    httpboot_proxy: "smart-proxy"
    mtu: 9000
    domains:
    - "{{ www_domain }}"
    dns_primary: 10.0.12.1
# VLAN 20 - 192.168.1.0/24
  - name: "192.168.1.0/24"
    network: "192.168.1.0"
    mask: "255.255.255.0"
    gateway: "192.168.1.1"
    boot_mode: "DHCP"
    from_ip: "192.168.1.210"
    to_ip: "192.168.1.250"
    mtu: 9000
    tftp_proxy: "smart-proxy"
    remote_execution_proxies: "smart-proxy"
    discovery_proxy: "smart-proxy"
    httpboot_proxy: "smart-proxy"
    domains:
    - "{{ www_domain }}"
    dns_primary: 192.168.1.1

foreman_installation_mediums:
  - name: "Ubuntu mirror"
    path: "http://archive.ubuntu.com/ubuntu"
    os_family: Debian


foreman_operatingsystems:
# Ubuntu 19.10
  - name: "Ubuntu"
    description: "Ubuntu 19.10"
    release_name: "eoan"
    family: "Debian"
    major: "19"
    minor: "10"
    provisioning_templates:
      - "Preseed default iPXE"
      - "Preseed default"
      - "Preseed default PXELinux"
      - "Preseed default finish"
      - "Preseed default user data"
    ptables:
      - "Preseed default"
      - "Preseed default LVM"
    architectures:
      - x86_64
    media: "Ubuntu mirror"
    parameters:
      - name: additional-packages
        parameter_type: yaml
        value:
          - curl
          - net-tools
      - name: kernel_params
        parameter_type: string
        value: "console=ttyS1,115200n8 console=tty1 net.ifnames=0 biosdevname=0 nosplash"
      - name: partitioning-type
        parameter_type: string
        value: "general"
      - name: partitioning-recipe
        parameter_type: string
        value: "atomic"
# Ubuntu 18.04.3 LTS
  - name: "Ubuntu"
    description: "Ubuntu 18.04.3 LTS"
    release_name: "bionic"
    family: "Debian"
    major: "18"
    minor: "04.3"
    provisioning_templates:
      - "Preseed default iPXE"
      - "Preseed default"
      - "Preseed default PXELinux"
      - "Preseed default finish"
      - "Preseed default user data"
    ptables:
      - "Preseed default"
      - "Preseed default LVM"
    architectures:
      - x86_64
    media: "Ubuntu mirror"
    parameters:
      - name: additional-packages
        parameter_type: yaml
        value:
          - curl
          - net-tools
          - ethtool
      - name: kernel_params
        parameter_type: string
        value: "console=ttyS1,115200n8 console=tty1 net.ifnames=0 biosdevname=0 nosplash"
      - name: partitioning-type
        parameter_type: string
        value: "general"
      - name: partitioning-recipe
        parameter_type: string
        value: "atomic"
# Ubuntu 18.04.2 LTS
  - name: "Ubuntu"
    description: "Ubuntu 18.04.2 LTS"
    release_name: "bionic"
    family: "Debian"
    major: "18"
    minor: "04.2"
    provisioning_templates:
      - "Preseed default iPXE"
      - "Preseed default"
      - "Preseed default PXELinux"
      - "Preseed default finish"
      - "Preseed default user data"
    ptables:
      - "Preseed default"
      - "Preseed default LVM"
    architectures:
      - x86_64
    media: "Ubuntu mirror"
    parameters:
      - name: additional-packages
        parameter_type: yaml
        value:
          - curl
          - net-tools
          - ethtool
      - name: kernel_params
        parameter_type: string
        value: "console=ttyS1,115200n8 console=tty1 net.ifnames=0 biosdevname=0 nosplash"
      - name: partitioning-type
        parameter_type: string
        value: "general"
      - name: partitioning-recipe
        parameter_type: string
        value: "atomic"
# Ubuntu 18.04
  - name: "Ubuntu"
    description: "Ubuntu 18.04"
    release_name: "bionic"
    family: "Debian"
    major: "18"
    minor: "04"
    provisioning_templates:
      - "Preseed default iPXE"
      - "Preseed default"
      - "Preseed default PXELinux"
      - "Preseed default finish"
      - "Preseed default user data"
    ptables:
      - "Preseed default"
      - "Preseed default LVM"
    architectures:
      - x86_64
    media: "Ubuntu mirror"
    parameters:
      - name: additional-packages
        parameter_type: yaml
        value:
          - curl
          - net-tools
          - ethtool
      - name: kernel_params
        parameter_type: string
        value: "console=ttyS1,115200n8 console=tty1 net.ifnames=0 biosdevname=0 nosplash"
      - name: partitioning-type
        parameter_type: string
        value: "general"
      - name: partitioning-recipe
        parameter_type: string
        value: "atomic"
# Ubuntu 19.04
  - name: "Ubuntu"
    description: "Ubuntu 19.04"
    release_name: "disco"
    family: "Debian"
    major: "19"
    minor: "04"
    provisioning_templates:
      - "Preseed default iPXE"
      - "Preseed default"
      - "Preseed default PXELinux"
      - "Preseed default finish"
      - "Preseed default user data"
    ptables:
      - "Preseed default"
      - "Preseed default LVM"
    architectures:
      - x86_64
    media: "Ubuntu mirror"
    parameters:
      - name: additional-packages
        parameter_type: yaml
        value:
          - curl
          - net-tools
          - ethtool
      - name: kernel_params
        parameter_type: string
        value: "console=ttyS1,115200n8 console=tty1 net.ifnames=0 biosdevname=0 nosplash"
      - name: partitioning-type
        parameter_type: string
        value: "general"
      - name: partitioning-recipe
        parameter_type: string
        value: "atomic"
# Ubuntu 16.04.5 LTS
  - name: "Ubuntu"
    description: "Ubuntu 16.04.5 LTS"
    release_name: "trusty"
    family: "Debian"
    major: "16"
    minor: "04.5"
    provisioning_templates:
      - "Preseed default iPXE"
      - "Preseed default"
      - "Preseed default PXELinux"
      - "Preseed default finish"
      - "Preseed default user data"
    ptables:
      - "Preseed default"
      - "Preseed default LVM"
    architectures:
      - x86_64
    media: "Ubuntu mirror"
    parameters:
      - name: additional-packages
        parameter_type: yaml
        value:
          - curl
          - net-tools
          - ethtool
      - name: kernel_params
        parameter_type: string
        value: "console=ttyS1,115200n8 console=tty1 net.ifnames=0 biosdevname=0 nosplash"
      - name: partitioning-type
        parameter_type: string
        value: "general"
      - name: partitioning-recipe
        parameter_type: string
        value: "atomic"
# CentOS 7.7
  - name: "CentOS"
    description: "CentOS 7.7"
    family: "Redhat"
    major: "7"
    minor: "7"
    provisioning_templates:
      - "Kickstart default iPXE"
      - "Kickstart default"
      - "Kickstart default PXELinux"
      - "Kickstart default finish"
      - "Kickstart default user data"
    ptables:
      - "Kickstart default"
      - "Kickstart default thin"
    architectures:
      - x86_64
    media: "CentOS mirror"
    parameters:
      - name: additional-packages
        parameter_type: yaml
        value:
          - net-tools
      - name: autopart_options
        parameter_type: string
        value: "--type=thinp --nohome --fstype=xfs"
      - name: kernel_params
        parameter_type: string
        value: "console=ttyS1,115200n8 console=tty1"
      - name: selinux-mode
        parameter_type: string
        value: "disabled"

foreman_os_default_templates:
# Ubuntu 19.10
  - operatingsystem: "Ubuntu 19.10"
    template_kind: "finish"
    provisioning_template: "Preseed default finish"
  - operatingsystem: "Ubuntu 19.10"
    template_kind: "provision"
    provisioning_template: "Preseed default"
  - operatingsystem: "Ubuntu 19.10"
    template_kind: "PXELinux"
    provisioning_template: "Preseed default PXELinux"
  - operatingsystem: "Ubuntu 19.10"
    template_kind: "iPXE"
    provisioning_template: "Preseed default iPXE"
  - operatingsystem: "Ubuntu 19.10"
    template_kind: "user_data"
    provisioning_template: "Preseed default user data"
# Ubuntu 19.04
  - operatingsystem: "Ubuntu 19.04"
    template_kind: "finish"
    provisioning_template: "Preseed default finish"
  - operatingsystem: "Ubuntu 19.04"
    template_kind: "provision"
    provisioning_template: "Preseed default"
  - operatingsystem: "Ubuntu 19.04"
    template_kind: "PXELinux"
    provisioning_template: "Preseed default PXELinux"
  - operatingsystem: "Ubuntu 19.04"
    template_kind: "iPXE"
    provisioning_template: "Preseed default iPXE"
  - operatingsystem: "Ubuntu 19.04"
    template_kind: "user_data"
    provisioning_template: "Preseed default user data"
# Ubuntu 18.04
  - operatingsystem: "Ubuntu 18.04"
    template_kind: "finish"
    provisioning_template: "Preseed default finish"
  - operatingsystem: "Ubuntu 18.04"
    template_kind: "provision"
    provisioning_template: "Preseed default"
  - operatingsystem: "Ubuntu 18.04"
    template_kind: "PXELinux"
    provisioning_template: "Preseed default PXELinux"
  - operatingsystem: "Ubuntu 18.04"
    template_kind: "iPXE"
    provisioning_template: "Preseed default iPXE"
  - operatingsystem: "Ubuntu 18.04"
    template_kind: "user_data"
    provisioning_template: "Preseed default user data"
# Ubuntu 18.04.3 LTS
  - operatingsystem: "Ubuntu 18.04.3 LTS"
    template_kind: "finish"
    provisioning_template: "Preseed default finish"
  - operatingsystem: "Ubuntu 18.04.3 LTS"
    template_kind: "provision"
    provisioning_template: "Preseed default"
  - operatingsystem: "Ubuntu 18.04.3 LTS"
    template_kind: "PXELinux"
    provisioning_template: "Preseed default PXELinux"
  - operatingsystem: "Ubuntu 18.04.3 LTS"
    template_kind: "iPXE"
    provisioning_template: "Preseed default iPXE"
  - operatingsystem: "Ubuntu 18.04.3 LTS"
    template_kind: "user_data"
    provisioning_template: "Preseed default user data"
# Ubuntu 18.04.2 LTS
  - operatingsystem: "Ubuntu 18.04.2 LTS"
    template_kind: "finish"
    provisioning_template: "Preseed default finish"
  - operatingsystem: "Ubuntu 18.04.2 LTS"
    template_kind: "provision"
    provisioning_template: "Preseed default"
  - operatingsystem: "Ubuntu 18.04.2 LTS"
    template_kind: "PXELinux"
    provisioning_template: "Preseed default PXELinux"
  - operatingsystem: "Ubuntu 18.04.2 LTS"
    template_kind: "iPXE"
    provisioning_template: "Preseed default iPXE"
  - operatingsystem: "Ubuntu 18.04.2 LTS"
    template_kind: "user_data"
    provisioning_template: "Preseed default user data"
# Ubuntu 16.04.5 LTS
  - operatingsystem: "Ubuntu 16.04.5 LTS"
    template_kind: "finish"
    provisioning_template: "Preseed default finish"
  - operatingsystem: "Ubuntu 16.04.5 LTS"
    template_kind: "provision"
    provisioning_template: "Preseed default"
  - operatingsystem: "Ubuntu 16.04.5 LTS"
    template_kind: "PXELinux"
    provisioning_template: "Preseed default PXELinux"
  - operatingsystem: "Ubuntu 16.04.5 LTS"
    template_kind: "iPXE"
    provisioning_template: "Preseed default iPXE"
  - operatingsystem: "Ubuntu 16.04.5 LTS"
    template_kind: "user_data"
    provisioning_template: "Preseed default user data"
# CentOS 7.7
  - operatingsystem: "CentOS 7.7"
    template_kind: "finish"
    provisioning_template: "Kickstart default finish"
  - operatingsystem: "CentOS 7.7"
    template_kind: "provision"
    provisioning_template: "Kickstart default"
  - operatingsystem: "CentOS 7.7"
    template_kind: "PXELinux"
    provisioning_template: "Kickstart default PXELinux"
  - operatingsystem: "CentOS 7.7"
    template_kind: "iPXE"
    provisioning_template: "Kickstart default iPXE"
  - operatingsystem: "CentOS 7.7"
    template_kind: "user_data"
    provisioning_template: "Kickstart default user data"

foreman_hostgroups:
# Machine Learning Hostgroup
  - name: "machine_learning"
    description: "Machine Learning Hostgroup"
    architecture: x86_64
    operatingsystem: "Ubuntu 18.04"
    medium: "Ubuntu mirror"
    ptable: "Preseed default LVM"
    pxe_loader: "PXELinux BIOS"
    domain: "{{ www_domain }}"
    subnet: "10.0.11.0/24"
    parameters:
      - name: blacklist
        parameter_type: string
        value: "nouveau"
# Ceph Hostgroup
  - name: "ceph"
    description: "Ceph Hostgroup"
    architecture: x86_64
    operatingsystem: "Ubuntu 18.04.3 LTS"
    medium: "Ubuntu mirror"
    ptable: "Preseed default"
    pxe_loader: "PXELinux BIOS"
    domain: "{{ www_domain }}"
    subnet: "192.168.1.0/24"
# Hypervisor Hostgroup
  - name: "hypervisor"
    description: "KVM Hypervisor Hostgroup"
    architecture: x86_64
    operatingsystem: "Ubuntu 18.04"
    medium: "Ubuntu mirror"
    ptable: "Preseed default LVM"
    pxe_loader: "PXELinux BIOS"
    domain: "{{ www_domain }}"
    subnet: "10.0.10.0/24"
# KVM Parent Hostgroup (Ubuntu)
  - name: "kvm-ubuntu"
    description: "KVM Ubuntu Hostgroup"
    architecture: x86_64
    operatingsystem: "Ubuntu 18.04.3 LTS"
    medium: "Ubuntu mirror"
    ptable: "Preseed default LVM"
    domain: "{{ www_domain }}"
    subnet: "10.0.10.0/24"
# KVM Parent Hostgroup (CentOS)
  - name: "kvm-centos"
    description: "KVM CentOS Hostgroup"
    architecture: x86_64
    operatingsystem: "CentOS 7.7"
    medium: "CentOS mirror"
    ptable: "Kickstart default thin"
    domain: "{{ www_domain }}"
    subnet: "10.0.10.0/24"
# VLAN 10 Hypervisor Hostgroups
  - name: "arthur-ubuntu-vlan10"
    description: "arthur vlan10 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.10.0/24"
    compute_resource: arthur
  - name: "ford-ubuntu-vlan10"
    description: "ford vlan10 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.10.0/24"
    compute_resource: ford
  - name: "trillian-ubuntu-vlan10"
    description: "trillian vlan10 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.10.0/24"
    compute_resource: trillian
  - name: "bumblebee-ubuntu-vlan10"
    description: "bumblebee vlan10 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.10.0/24"
    compute_resource: bumblebee
  - name: "optimus-ubuntu-vlan10"
    description: "optimus vlan10 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.10.0/24"
    compute_resource: optimus
  - name: "zaphod-ubuntu-vlan10"
    description: "zaphod vlan10 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.10.0/24"
    compute_resource: zaphod
  - name: "devastator-ubuntu-vlan10"
    description: "devastator vlan10 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.10.0/24"
    compute_resource: devastator
  - name: "starscream-ubuntu-vlan10"
    description: "starscream vlan10 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.10.0/24"
    compute_resource: starscream
# VLAN 11 Hypervisor Hostgroups
  - name: "arthur-ubuntu-vlan11"
    description: "arthur vlan11 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.11.0/24"
    compute_resource: arthur
  - name: "ford-ubuntu-vlan11"
    description: "ford vlan11 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.11.0/24"
    compute_resource: ford
  - name: "trillian-ubuntu-vlan11"
    description: "trillian vlan11 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.11.0/24"
    compute_resource: trillian
  - name: "bumblebee-ubuntu-vlan11"
    description: "bumblebee vlan11 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.11.0/24"
    compute_resource: bumblebee
  - name: "optimus-ubuntu-vlan11"
    description: "optimus vlan11 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.11.0/24"
    compute_resource: optimus
  - name: "zaphod-ubuntu-vlan11"
    description: "zaphod vlan11 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.11.0/24"
    compute_resource: zaphod
  - name: "devastator-ubuntu-vlan11"
    description: "devastator vlan11 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.11.0/24"
    compute_resource: devastator
  - name: "starscream-ubuntu-vlan11"
    description: "starscream vlan11 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.11.0/24"
    compute_resource: starscream
# VLAN 12 Hypervisor Hostgroups
  - name: "arthur-ubuntu-vlan12"
    description: "arthur vlan12 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.12.0/24"
    compute_resource: arthur
  - name: "ford-ubuntu-vlan12"
    description: "ford vlan12 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.12.0/24"
    compute_resource: ford
  - name: "trillian-ubuntu-vlan12"
    description: "trillian vlan12 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.12.0/24"
    compute_resource: trillian
  - name: "bumblebee-ubuntu-vlan12"
    description: "bumblebee vlan12 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.12.0/24"
    compute_resource: bumblebee
  - name: "optimus-ubuntu-vlan12"
    description: "optimus vlan12 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.12.0/24"
    compute_resource: optimus
  - name: "zaphod-ubuntu-vlan12"
    description: "zaphod vlan12 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.12.0/24"
    compute_resource: zaphod
  - name: "devastator-ubuntu-vlan12"
    description: "devastator vlan12 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.12.0/24"
    compute_resource: devastator
  - name: "starscream-ubuntu-vlan12"
    description: "starscream vlan12 KVM Hypervisor Hostgroup (Ubuntu)"
    parent: kvm-ubuntu
    subnet: "10.0.12.0/24"
    compute_resource: starscream

# VLAN 10 Hypervisor Hostgroups (CentOS)
  - name: "arthur-centos-vlan10"
    description: "arthur vlan10 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.10.0/24"
    compute_resource: arthur
  - name: "ford-centos-vlan10"
    description: "ford vlan10 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.10.0/24"
    compute_resource: ford
  - name: "trillian-centos-vlan10"
    description: "trillian vlan10 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.10.0/24"
    compute_resource: trillian
  - name: "bumblebee-centos-vlan10"
    description: "bumblebee vlan10 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.10.0/24"
    compute_resource: bumblebee
  - name: "optimus-centos-vlan10"
    description: "optimus vlan10 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.10.0/24"
    compute_resource: optimus
  - name: "zaphod-centos-vlan10"
    description: "zaphod vlan10 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.10.0/24"
    compute_resource: zaphod
  - name: "devastator-centos-vlan10"
    description: "devastator vlan10 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.10.0/24"
    compute_resource: devastator
  - name: "starscream-centos-vlan10"
    description: "starscream vlan10 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.10.0/24"
    compute_resource: starscream
# VLAN 11 Hypervisor Hostgroups (CentOS)
  - name: "arthur-centos-vlan11"
    description: "arthur vlan11 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.11.0/24"
    compute_resource: arthur
  - name: "ford-centos-vlan11"
    description: "ford vlan11 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.11.0/24"
    compute_resource: ford
  - name: "trillian-centos-vlan11"
    description: "trillian vlan11 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.11.0/24"
    compute_resource: trillian
  - name: "bumblebee-centos-vlan11"
    description: "bumblebee vlan11 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.11.0/24"
    compute_resource: bumblebee
  - name: "optimus-centos-vlan11"
    description: "optimus vlan11 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.11.0/24"
    compute_resource: optimus
  - name: "zaphod-centos-vlan11"
    description: "zaphod vlan11 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.11.0/24"
    compute_resource: zaphod
  - name: "devastator-centos-vlan11"
    description: "devastator vlan11 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.11.0/24"
    compute_resource: devastator
  - name: "starscream-centos-vlan11"
    description: "starscream vlan11 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.11.0/24"
    compute_resource: starscream
# VLAN 12 Hypervisor Hostgroups (CentOS)
  - name: "arthur-centos-vlan12"
    description: "arthur vlan12 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.12.0/24"
    compute_resource: arthur
  - name: "ford-centos-vlan12"
    description: "ford vlan12 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.12.0/24"
    compute_resource: ford
  - name: "trillian-centos-vlan12"
    description: "trillian vlan12 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.12.0/24"
    compute_resource: trillian
  - name: "bumblebee-centos-vlan12"
    description: "bumblebee vlan12 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.12.0/24"
    compute_resource: bumblebee
  - name: "optimus-centos-vlan12"
    description: "optimus vlan12 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.12.0/24"
    compute_resource: optimus
  - name: "zaphod-centos-vlan12"
    description: "zaphod vlan12 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.12.0/24"
    compute_resource: zaphod
  - name: "devastator-centos-vlan12"
    description: "devastator vlan12 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.12.0/24"
    compute_resource: devastator
  - name: "starscream-centos-vlan12"
    description: "starscream vlan12 KVM Hypervisor Hostgroup (CentOS)"
    parent: kvm-centos
    subnet: "10.0.12.0/24"
    compute_resource: starscream
foreman_compute_resources:
  - name: "arthur"
    provider: libvirt
    provider_params:
      url: qemu+tcp://10.0.10.85/system
      display_type: spice
  - name: "ford"
    provider: libvirt
    provider_params:
      url: qemu+tcp://10.0.10.87/system
      display_type: spice
  - name: "trillian"
    provider: libvirt
    provider_params:
      url: qemu+tcp://10.0.10.86/system
      display_type: spice
  - name: "bumblebee"
    provider: libvirt
    provider_params:
      url: qemu+tcp://10.0.10.81/system
      display_type: spice
  - name: "optimus"
    provider: libvirt
    provider_params:
      url: qemu+tcp://10.0.10.140/system
      display_type: spice
  - name: "zaphod"
    provider: libvirt
    provider_params:
      url: qemu+tcp://10.0.10.88/system
      display_type: spice
  - name: "devastator"
    provider: libvirt
    provider_params:
      url: qemu+tcp://10.0.10.80/system
      display_type: spice
  - name: "starscream"
    provider: libvirt
    provider_params:
      url: qemu+tcp://10.0.10.89/system
      display_type: spice

foreman_hosts: []


awx_notification_email: 9412863602@mypixmessages.com
awx_host_config_key: 16a4a143-0f6e-49b6-8051-fe135b6fdffa

awx_host_port: 8080
awx_web_url: "http://{{ ansible_default_ipv4.address }}:{{ awx_host_port }}"
awx_project_data_dir: /var/lib/awx
awx_postgres_data_dir: /var/lib/pgawx

awx_rabbitmq_erlang_cookie: "{{ vault_rabbitmq_erlang_cookie }}"
awx_rabbitmq_password: "{{ vault_rabbitmq_password }}"

awx_pg_password: "{{ vault_pg_password }}"
awx_pg_admin_password: "{{ vault_pg_admin_password }}"

awx_secret_key: "{{ vault_secret_key }}"

awx_admin_user: admin
awx_admin_password: "{{ vault_awx_admin_password }}"


awx_rabbitmq_version: "3.7.4"
awx_rabbitmq_image: "ansible/awx_rabbitmq:{{ awx_rabbitmq_version }}"
awx_rabbitmq_default_vhost: "awx"
awx_rabbitmq_host: "rabbitmq"
awx_rabbitmq_port: "5672"
awx_rabbitmq_user: "guest"

awx_postgresql_version: "10"
awx_postgresql_image: "postgres:{{ awx_postgresql_version }}"


awx_memcached_image: "memcached"
awx_memcached_version: "alpine"
awx_memcached_host: "memcached"
awx_memcached_port: "11211"

awx_dockerhub_base: ansible
awx_dockerhub_version: 9.0.0
awx_create_preload_data: True


awx_docker_compose_dir: /var/lib/awxcompose
awx_pg_username: awx
awx_pg_database: awx
awx_pg_port: 5432


awx_web_hostname: awxweb
awx_task_hostname: awx


awx_inventories:
  - name: "home.prettybaked.com"
    description: "home servers"
    organization: "Default"
  - name: "Demo Inventory"
    state: absent

awx_inventory_sources:
# Static Inventory
  - name: "home.prettybaked.com"
    description: "home inventory file"
    inventory: "home.prettybaked.com"
    source: scm
    source_project: home-ansible-awx
    source_path: inventory
    overwrite: yes
    overwrite_vars: yes
    update_on_launch: yes
    update_cache_timeout: 300
# Foreman dynamic inventory
  - name: "foreman.py"
    description: "Foreman Dynamic Inventory"
    inventory: "home.prettybaked.com"
    source: scm
    source_project: home-ansible-awx
    source_path: foreman.py
    credential: foreman.ini
    overwrite: yes
    overwrite_vars: no
    update_on_launch: yes
    update_cache_timeout: 300


awx_hosts: []


awx_credential_types:
  - name: foreman.ini
    description: Foreman Dynamic Inventory
    kind: cloud
    inputs: "{{ lookup('template', 'foreman_input.yml.j2') | from_yaml }}"
    injectors: "{{ lookup('template', 'foreman_injector.yml.j2') | from_yaml }}"


awx_credentials:
  - name: "Demo Credential"
    kind: ssh
    state: absent
  - name: ansible-root
    kind: ssh
    ssh_key_data: "{{ awx_github_deploy_key }}"
  - name: ansible-github
    kind: scm
    ssh_key_data: "{{ awx_github_deploy_key }}"
  - name: ansible-vault
    vault_id: ansible-vault
    kind: vault
    vault_password: "{{ vault_awx_vault_password }}"
  - name: foreman.ini
    credential_type: foreman.ini
    inputs:
      password: "{{ foreman_admin_password }}"
      username: "{{ foreman_admin_user }}"
      url: "http://{{ ansible_default_ipv4.address }}:{{ foreman_port }}"

awx_projects:
  - name: "Demo Project"
    state: absent
  # Home Ansible Project
  - name: "home-ansible-awx"
    description: "Home Ansible AWX"
    scm_type: git
    scm_credential: ansible-github
    scm_clean: yes
    scm_branch: master
    scm_update_on_launch: yes
    scm_update_cache_timeout: 900
    scm_url: git@github.com:ajanis/home-ansible-awx.git
    local_path: "home-ansible-awx"
  # Machine Learning Project
  - name: "machine-learning"
    description: "Machine learning services"
    scm_type: git
    scm_credential: ansible-github
    scm_clean: yes
    scm_branch: master
    scm_update_on_launch: yes
    scm_update_cache_timeout: 900
    scm_url: https://github.com/constructorfleet/ansible-machine-learning-project.git
    local_path: "machine-learning"
  # Media Services Project
  - name: "mediaserver-project"
    description: "Deploy suite of media-server components"
    scm_type: git
    scm_credential: ansible-github
    scm_clean: yes
    scm_branch: master
    scm_update_on_launch: yes
    scm_update_cache_timeout: 900
    scm_url: git@github.com:ajanis/ansible-mediaserver-project.git
    local_path: "mediaserver-project"

awx_job_templates:
  - name: "Demo Job Template"
    project:
    job_type: run
    playbook:
    state: absent
# Ansible Host Auto-Config Callback Job
  - name: "Host Configure"
    description: "Server post-install configuration"
    job_type: "run"
    host_config_key: "{{ awx_host_config_key }}"
    fact_caching_enabled: yes
    concurrent_jobs_enabled: yes
    diff_mode_enabled: yes
    inventory: "home.prettybaked.com"
    ask_limit: no
    project: "home-ansible-awx"
    playbook: "callback_autoconfig.yml"
    credentials:
      - ansible-root
      - ansible-vault
# Server Base Configuration
  - name: "Server Base Configuration"
    description: "common, ldap, cephfs playbooks"
    job_type: "run"
    fact_caching_enabled: yes
    concurrent_jobs_enabled: yes
    diff_mode_enabled: yes
    inventory: "home.prettybaked.com"
    ask_limit: yes
    survey_enabled: no
    project: "home-ansible-awx"
    playbook: "base.yml"
    credentials:
      - ansible-root
      - ansible-vault
# Server Common Configuration
  - name: "Server Common Configuration"
    description: "common playbook"
    job_type: "run"
    fact_caching_enabled: yes
    concurrent_jobs_enabled: yes
    diff_mode_enabled: yes
    inventory: "home.prettybaked.com"
    ask_limit: yes
    survey_enabled: no
    project: "home-ansible-awx"
    playbook: "common.yml"
    credentials:
      - ansible-root
      - ansible-vault
# Netplan Configuration
  - name: "Netplan Network Configuration"
    description: "update host network settings via netplan"
    job_type: "run"
    fact_caching_enabled: yes
    concurrent_jobs_enabled: yes
    diff_mode_enabled: yes
    inventory: "home.prettybaked.com"
    ask_limit: yes
    survey_enabled: no
    project: "home-ansible-awx"
    playbook: "netplan.yml"
    credentials:
      - ansible-root
      - ansible-vault
# Telegraf Configuration
  - name: "Telegraf Configuration"
    description: "configure host telegraf service"
    job_type: "run"
    fact_caching_enabled: yes
    concurrent_jobs_enabled: yes
    diff_mode_enabled: yes
    inventory: "home.prettybaked.com"
    ask_limit: yes
    survey_enabled: no
    project: "home-ansible-awx"
    playbook: "telegraf.yml"
    credentials:
      - ansible-root
      - ansible-vault
# Ubiquiti Services
  - name: "Deploy Ubiquiti Services"
    description: "Set up Unifi-Admin, UNMS and stats-collection"
    job_type: "run"
    fact_caching_enabled: yes
    concurrent_jobs_enabled: yes
    diff_mode_enabled: yes
    inventory: "home.prettybaked.com"
    ask_limit: no
    limit: "unifi unms"
    survey_enabled: no
    project: "home-ansible-awx"
    playbook: "unifi.yml"
    credentials:
      - ansible-root
      - ansible-vault
# Update webservices Nginx
  - name: "Webservices Nginx Config"
    description: "Install and configure Nginx on Webservices Host"
    job_type: "run"
    fact_caching_enabled: yes
    concurrent_jobs_enabled: yes
    diff_mode_enabled: yes
    inventory: "home.prettybaked.com"
    ask_limit: no
    limit: "webservices"
    survey_enabled: no
    project: "home-ansible-awx"
    playbook: "nginx.yml"
    credentials:
      - ansible-root
      - ansible-vault
# Media Services
  - name: "Media Services"
    description: "Install and configure Media Services"
    job_type: "run"
    fact_caching_enabled: yes
    concurrent_jobs_enabled: yes
    diff_mode_enabled: yes
    inventory: "home.prettybaked.com"
    ask_limit: no
    limit: "mediaservices nzbservices plexservers"
    survey_enabled: no
    project: "home-ansible-awx"
    playbook: "mediaservices.yml"
    credentials:
      - ansible-root
      - ansible-vault
# Media Stack
  - name: "Media Stack"
    description: "Install and configure Media Service Stack"
    job_type: "run"
    fact_caching_enabled: yes
    concurrent_jobs_enabled: yes
    diff_mode_enabled: yes
    inventory: "home.prettybaked.com"
    ask_limit: no
    limit: "mediaservices nzbservices plexservers webservices"
    survey_enabled: no
    project: "home-ansible-awx"
    playbook: "media-services.yml"
    credentials:
      - ansible-root
      - ansible-vault
# Docker Installation / Config
  - name: "Docker"
    description: "Install and configure Docker and containers"
    job_type: "run"
    fact_caching_enabled: yes
    concurrent_jobs_enabled: yes
    diff_mode_enabled: yes
    inventory: "home.prettybaked.com"
    ask_limit: yes
    survey_enabled: no
    project: "home-ansible-awx"
    playbook: "docker.yml"
    credentials:
      - ansible-root
      - ansible-vault
# Foreman Services
  - name: "Foreman Configuration"
    description: "Install and configure Foreman services"
    job_type: "run"
    fact_caching_enabled: yes
    concurrent_jobs_enabled: yes
    diff_mode_enabled: yes
    inventory: "home.prettybaked.com"
    ask_limit: no
    ask_tags: yes
    limit: "foreman"
    survey_enabled: no
    project: "home-ansible-awx"
    playbook: "foreman.yml"
    credentials:
      - ansible-root
      - ansible-vault
# AWX Services
  - name: "AWX Configuration"
    description: "Install and configure AWX services"
    job_type: "run"
    fact_caching_enabled: yes
    concurrent_jobs_enabled: yes
    diff_mode_enabled: yes
    inventory: "home.prettybaked.com"
    ask_tags: yes
    ask_limit: no
    limit: "foreman"
    survey_enabled: no
    project: "home-ansible-awx"
    playbook: "awx.yml"
    credentials:
      - ansible-root
      - ansible-vault
# Machine Learning Services
  - name: "Machine Learning"
    description: "Deploy and configure machine-learning services"
    job_type: "run"
    fact_caching_enabled: yes
    concurrent_jobs_enabled: yes
    diff_mode_enabled: yes
    inventory: "home.prettybaked.com"
    ask_limit: no
    limit: "machine_learning"
    survey_enabled: no
    project: "machine-learning"
    playbook: "main.yml"
    credentials:
      - ansible-root
      - ansible-vault
# Create KVM Host
  - name: "Build KVM Server"
    description: "Deploy KVM guest via Foreman"
    job_type: "run"
    fact_caching_enabled: yes
    concurrent_jobs_enabled: yes
    diff_mode_enabled: yes
    inventory: "home.prettybaked.com"
    ask_limit: no
    survey_enabled: yes
    limit: "{{ ansible_fqdn }}"
    project: "home-ansible-awx"
    playbook: "build-host-deploy.yml"
    credentials:
      - ansible-root
      - ansible-vault
    #extra_vars: "{{ lookup('file', 'kvm_job_vars.yml') | from_yaml }}"
    extra_vars:
      foreman_hosts:
        - name: '{% raw %}{{ survey_hostname }}{% endraw %}'
          hostgroup: '{% raw %}{{ survey_hypervisor }}-{% if "Ubuntu" in survey_os %}ubuntu{% else %}centos{% endif %}-vlan{{ survey_vlan_id }}{% endraw %}'
          provider: '{% raw %}kvm{% endraw %}'
          cpu_cores: '{% raw %}{{ survey_cpu_cores }}{% endraw %}'
          memory: '{% raw %}{{ survey_memory }}G{% endraw %}'
          disk_size: '{% raw %}{{ survey_disk_size }}G{% endraw %}'
          vlan_id: '{% raw %}{{ survey_vlan_id }}{% endraw %}'
    survey_spec: |
      description: "Build KVM Server Survey"
      name: "build_kvm_server_survey"
      spec:
        - choices: null
          max: 15
          min: 0
          question_description: "Enter a hostname for the new VM."
          question_name: Hostname
          required: true
          type: text
          variable: survey_hostname
        - choices: "CentOS 7.7\nUbuntu 18.04"
          max: null
          min: null
          question_description: "Select an OS for new VM."
          question_name: OS
          required: true
          type: multiplechoice
          variable: survey_os
        - choices: "bumblebee\noptimus\ndevastator\ntrillian\nford\nzaphod\narthur"
          default: {{ omit }}
          max: null
          min: null
          question_description: "Which hypervisor should VM be created on?"
          question_name: Hypervisor
          required: true
          type: multiplechoice
          variable: survey_hypervisor
        - choices: "10\n11\n12"
          default: "10"
          max: null
          min: null
          question_description: "Select a VLAN for new VM."
          question_name: "Vlan id"
          required: true
          type: multiplechoice
          variable: survey_vlan_id
        - choices: {{ omit }}
          default: 1
          max: 16
          min: 1
          question_description: "Enter number of CPU Cores (1-16) for VM."
          question_name: Vcpu
          required: true
          type: integer
          variable: survey_cpu_cores
        - choices: {{ omit }}
          default: 1
          max: 16
          min: 1
          question_description: "Enter amount of RAM (1-16)GB for VM."
          question_name: Memory
          required: true
          type: integer
          variable: survey_memory
        - choices: {{ omit }}
          default: 10
          max: 150
          min: 10
          question_description: "Set Disk Size (10-150)GB for VM."
          question_name: "Disk Size"
          required: true
          type: integer
          variable: survey_disk_size

awx_config_settings:
  - name: SESSION_COOKIE_AGE
    value: 28800
  - name: AUTH_LDAP_SERVER_URI
    value: "ldap://10.0.10.15:389"
  - name: AUTH_LDAP_BIND_DN
    value: "cn=Manager,dc=ldap,dc=home,dc=prettybaked,dc=com"
  - name: AUTH_LDAP_GROUP_TYPE
    value: "PosixGroupType"
  - name: AUTH_LDAP_USER_SEARCH
    value:
      - "ou=users,dc=ldap,dc=home,dc=prettybaked,dc=com"
      - "SCOPE_SUBTREE"
      - "(uid=%(user)s)"
  - name: AUTH_LDAP_GROUP_SEARCH
    value:
      - "ou=groups,dc=ldap,dc=home,dc=prettybaked,dc=com"
      - "SCOPE_SUBTREE"
      - "(objectClass=posixGroup)"

  - name: AUTH_LDAP_USER_ATTR_MAP
    value:
      "first_name": "givenName"
      "last_name": "sn"
      "email": "mail"

  - name: AUTH_LDAP_GROUP_TYPE_PARAMS
    value:
      "name_attr": "cn"

  - name: AUTH_LDAP_USER_FLAGS_BY_GROUP
    value:
      "is_superuser":
        - "cn=admin,ou=groups,dc=ldap,dc=home,dc=prettybaked,dc=com"

  - name: AUTH_LDAP_ORGANIZATION_MAP
    value:
      "Default":
        "admins": "cn=admin,ou=groups,dc=ldap,dc=home,dc=prettybaked,dc=com"
        "remove_users": "false"
        "remove_admins": "false"

  - name: AUTH_LDAP_TEAM_MAP
    value:
      "LDAP Admins":
        "users": "cn=admin,ou=groups,dc=ldap,dc=home,dc=prettybaked,dc=com"
        "organization": "Default"
        "remove": "false"

  - name: AUTH_LDAP_BIND_PASSWORD
    value: "{{ openldap_server_rootpw }}"


docker_containers:
  postgres:
    description: "Foreman Postgresql DB"
    image: postgres:11
    env:
      PUID: '0'
      PGID: '0'
      VERSION: 'latest'
      POSTGRES_USER: '{{ foreman_db_username }}'
      POSTGRES_PASSWORD: '{{ vault_foreman_db_password }}'
      POSTGRES_DB: '{{ foreman_db_name }}'
    ports:
      - '5432:5432'
    volumes:
      - '/etc/localtime:/etc/localtime:ro'
      - '/var/lib/postgresql/data:/var/lib/postgresql/data'

docker_compose_projects:
  - project_name: awx
    pull: yes
#     config_path: "{{ awx_docker_compose_dir }}"
    definition:
      version: '3.4'
      x-logging: &default-logging
        driver: journald
      networks:
        docker_awx:
          driver: bridge
          ipam:
            driver: default
            config:
              - subnet: 172.3.27.0/24
      services:
        postgres:
          image: postgres:10
          hostname: postgres
          networks:
            - docker_awx
          volumes:
            - "{{ awx_postgres_data_dir }}/10/data/:/var/lib/postgresql/data/pgdata:Z"
          environment:
            POSTGRES_USER: "{{ awx_pg_username }}"
            POSTGRES_PASSWORD: "{{ awx_pg_password }}"
            POSTGRES_DB: "{{ awx_pg_database }}"
            PGDATA: "/var/lib/postgresql/data/pgdata"
            http_proxy: "{{ http_proxy | default('') }}"
            https_proxy: "{{ https_proxy | default('') }}"
            no_proxy: "{{ no_proxy | default('') }}"
          logging:
            << : *default-logging
            options:
              tag: awx_postgres
        rabbitmq:
          image: "{{ awx_rabbitmq_image }}"
          volumes:
            - '/etc/localtime:/etc/localtime:ro'
          networks:
            - docker_awx
          hostname: rabbitmq
          environment:
            RABBITMQ_DEFAULT_VHOST: "{{ awx_rabbitmq_default_vhost }}"
            RABBITMQ_DEFAULT_USER: "{{ awx_rabbitmq_user }}"
            RABBITMQ_DEFAULT_PASS: "{{ awx_rabbitmq_password | quote }}"
            RABBITMQ_ERLANG_COOKIE: "{{ awx_rabbitmq_erlang_cookie }}"
            http_proxy: "{{ http_proxy | default('') }}"
            https_proxy: "{{ https_proxy | default('') }}"
            no_proxy: "{{ no_proxy | default('') }}"
          logging:
            <<  : *default-logging
            options:
              tag: awx_rabbitmq
        memcached:
          image: "{{ awx_memcached_image }}:{{ awx_memcached_version }}"
          hostname: "{{ awx_memcached_host }}"
          networks:
            - docker_awx
          volumes:
            - '/etc/localtime:/etc/localtime:ro'
          environment:
            http_proxy: "{{ http_proxy | default('') }}"
            https_proxy: "{{ https_proxy | default('') }}"
            no_proxy: "{{ no_proxy | default('') }}"
          logging:
            << : *default-logging
            options:
              tag: awx_memcached
        task:
          image: "{{ awx_dockerhub_base }}/awx_task:{{ awx_dockerhub_version }}"
          hostname: "{{ awx_task_hostname }}"
          depends_on:
            - memcached
            - rabbitmq
            - postgres
          networks:
            - docker_awx
          user: root
          volumes:
            - "{{ awx_docker_compose_dir }}/SECRET_KEY:/etc/tower/SECRET_KEY"
            - "{{ awx_docker_compose_dir }}/environment.sh:/etc/tower/conf.d/environment.sh"
            - "{{ awx_docker_compose_dir }}/credentials.py:/etc/tower/conf.d/credentials.py"
            - "{{ awx_project_data_dir }}:/var/lib/awx/projects:rw"
            - '/etc/localtime:/etc/localtime:ro'
          environment:
            http_proxy: "{{ http_proxy | default('') }}"
            https_proxy: "{{ https_proxy | default('') }}"
            no_proxy: "{{ no_proxy | default('') }}"
          logging:
            << : *default-logging
            options:
              tag: awx_task
        web:
          image: "{{ awx_dockerhub_base }}/awx_web:{{ awx_dockerhub_version }}"
          depends_on:
            - memcached
            - rabbitmq
            - postgres
          ports:
            - "{{ awx_host_port }}:8052"
          networks:
            - docker_awx
          hostname: "{{ awx_web_hostname }}"
          user: root
          volumes:
            - "{{ awx_docker_compose_dir }}/SECRET_KEY:/etc/tower/SECRET_KEY"
            - "{{ awx_docker_compose_dir }}/environment.sh:/etc/tower/conf.d/environment.sh"
            - "{{ awx_docker_compose_dir }}/credentials.py:/etc/tower/conf.d/credentials.py"
            - "{{ awx_docker_compose_dir }}/nginx.conf:/etc/nginx/nginx.conf:ro"
            - "{{ awx_project_data_dir }}:/var/lib/awx/projects:rw"
            - '/etc/localtime:/etc/localtime:ro'
          environment:
            http_proxy: "{{ http_proxy | default('') }}"
            https_proxy: "{{ https_proxy | default('') }}"
            no_proxy: "{{ no_proxy | default('') }}"
          logging:
            << : *default-logging
            options:
              tag: awx_web

fail2ban_enable: False

nginx_backends:
  - service: foreman
    servers:
      - localhost:3000
  - service: tower
    servers:
      - localhost:8080

nginx_vhosts:
  - servername: "{{ (foreman_hostname + '.' + www_domain) | default(ansible_fqdn) }}"
    serveralias: "{{ ansible_default_ipv4.address }} {{ ansible_fqdn }}"
    serverlisten: 80
    extra_parameters: |
      error_page 404 /404.html;
      error_page 500 502 503 504 /50x.html;
    locations:
      - name: /
        proxy: True
        backend: foreman
      - name: /webcon
        proxy: True
        backend: foreman
        extra_parameters: |
          proxy_set_header       Connection          "upgrade";
          proxy_set_header        upgrade             $http_upgrade;
      - name: 404.html
        docroot: "/usr/share/nginx/html"
      - name: 50x.html
        docroot: "/usr/share/nginx/html"

  - servername: "awx.home.prettybaked.com"
    serveralias: "awx tower tower.home.prettybaked.com"
    serverlisten: 80
    locations:
      - name: /
        proxy: True
        backend: tower
        extra_parameters: |
          proxy_set_header       Connection          "upgrade";
          proxy_set_header        upgrade             $http_upgrade;


nginx_vhosts_ssl:
  - servername: "{{ (foreman_hostname + '.' + www_domain) | default(ansible_fqdn) }}"
    serverlisten: "443"
    extra_parameters: |
      error_page 404 /404.html;
      error_page 500 502 503 504 /50x.html;
    ssl_certchain: "{{ ssl_certchain }}"
    ssl_privkey: "{{ ssl_privkey }}"
    ssl_certpath: "{{ ssl_certpath }}"
    ssl_keypath: "{{ ssl_keypath }}"
    locations:
      - name: /
        proxy: True
        backend: foreman
      - name: /webcon
        proxy: True
        backend: foreman
        extra_parameters: |
          proxy_set_header       Connection          "upgrade";
          proxy_set_header        upgrade             $http_upgrade;
      - name: 404.html
        docroot: "/usr/share/nginx/html"
      - name: 50x.html
        docroot: "/usr/share/nginx/html"
  - servername: "awx.home.prettybaked.com"
    serveralias: "tower.home.prettybaked.com"
    serverlisten: 443
    ssl_certchain: "{{ ssl_certchain }}"
    ssl_privkey: "{{ ssl_privkey }}"
    ssl_certpath: "{{ ssl_certpath }}"
    ssl_keypath: "{{ ssl_keypath }}"
    locations:
      - name: /
        proxy: True
        backend: tower
        extra_parameters: |
          proxy_set_header       Connection          "upgrade";
          proxy_set_header        upgrade             $http_upgrade;
